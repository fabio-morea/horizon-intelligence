---
title: "figure2"
format: html
editor: visual
---

```{r}
library(igraph)
library(tidyverse)
source('./code/hi_0_parameters.R')
source('./code/hi_functions.R')

```

```{r}
perc_tech <- c()
for(yy in 2015:2026){
    
print(yy)
g <- read.graph(file = paste0('data/filtered-h/',yy,'.graphml'),format = 'graphml') |> igraph::simplify(edge.attr.comb = "sum") 

E(g)$weight |> plot()

E(g)$weight <- E(g)$weight  %>% round(0)
g <- delete_edges(g, E(g)[weight <= 0.0])
g <- delete_vertices(g, V(g)[degree(g) ==0])
perc_tech<- c(perc_tech, mean(E(g)$tech))
#png(paste0('./figures/2-full network/',yy,'.png'))
par(mar=c(0,0,0,0))
plot(g, vertex.label = NA, 
     vertex.size = V(g)$str/50 ,
     layout = layout.fruchterman.reingold(g), 
     main = yy, 
     asp = .5)
#dev.off()
}

bubblesize <- sqrt(V(g)$str)|> round(0)
hist(bubblesize)
g |> igraph::as_data_frame() -> tmp
V(g)$str |> plot()
V(g)$weight
```

```{r}
perc_tech 
(1-perc_tech) |> barplot()
```

# 3 networks

```{r}
# complete
yy = 2024

g <- read.graph(file = paste0('data/filtered-h/',yy,'.graphml'),format = 'graphml') 
print(paste("G: ", mean(E(g)$tech), "vertices: ", vcount(g), "edges: ", ecount(g)))

g <- delete_edges(g,  E(g)[E(g)$tech == FALSE] )
g <- delete_vertices(g, V(g)[degree(g) ==0])|> igraph::simplify(edge.attr.comb = "sum")
g <- igraph::simplify(g, edge.attr.comb = "sum")
print(paste("G: ", mean(E(g)$tech), "vertices: ", vcount(g), "edges: ", ecount(g)))

#png(paste0('./figures/2-full network/',yy,'.png'))

par(mar=c(0,0,0,0))
plot(g, vertex.label = NA, 
     vertex.size = sqrt(V(g)$R_strength) *50,
     vertex.color = V(g)$community,
     layout = layout_with_graphopt(g), 
     #main = yy, 
     asp = 1.0)
#dev.off()

```

```{r}
# complete
yy = 2024

g <- read.graph(file = paste0('data/filtered-h/',yy,'.graphml'),format = 'graphml') 
print(paste("G: ", mean(E(g)$tech), "vertices: ", vcount(g), "edges: ", ecount(g)))
# V(g)$R_strength<-round(V(g)$R_strength,5)
# g <- delete_vertices(g, V(g)[V(g)$R_strength ==0])

g <- delete_edges(g,  E(g)[E(g)$tech == TRUE] )
g <- delete_vertices(g, V(g)[degree(g) ==0]) 
g <- igraph::simplify(g, edge.attr.comb = "sum")
print(paste("G: ", mean(E(g)$tech), "vertices: ", vcount(g), "edges: ", ecount(g)))

#png(paste0('./figures/2-full network/',yy,'.png'))

par(mar=c(0,0,0,0))
plot(g, vertex.label = NA, 
     vertex.size = sqrt(V(g)$R_strength) *30,
     vertex.color = V(g)$community,
     layout = layout_with_graphopt(g), 
     #main = yy, 
     asp = 1)
#dev.off()

```

```{r}
print("hello")
```
